

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ubuntu 18.04 server &mdash; Li&#39;s BLOG 1.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="django restframework" href="django_restframework.html" />
    <link rel="prev" title="Welcome to Li’s BLOG’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Li's BLOG
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ubuntu 18.04 server</a></li>
<li class="toctree-l1"><a class="reference internal" href="#apt">修改 apt 软件源为阿里云的源</a></li>
<li class="toctree-l1"><a class="reference internal" href="#root">设置root密码</a></li>
<li class="toctree-l1"><a class="reference internal" href="#sudo">关闭sudo密码</a></li>
<li class="toctree-l1"><a class="reference internal" href="#utc">关闭UTC时间同步(双系统)</a></li>
<li class="toctree-l1"><a class="reference internal" href="#zsh-oh-my-zsh">安装<strong>安装 zsh 和 oh-my-zsh</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#zsh">ZSH 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">ZSH 插件安装</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#xshell">xshell上传下载文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id2">安装压缩包</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id3">配置全局环境变量</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id4">创建软链接</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#scp">scp传输文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id5">配置桌面快捷方式</a></li>
<li class="toctree-l1"><a class="reference internal" href="#rmpdeb">rmp格式安装包转deb</a></li>
<li class="toctree-l1"><a class="reference internal" href="#gnome">安装GNOME桌面</a></li>
<li class="toctree-l1"><a class="reference internal" href="#python">安装Python虚拟环境</a></li>
<li class="toctree-l1"><a class="reference internal" href="#pip">pip 国内源</a></li>
<li class="toctree-l1"><a class="reference internal" href="#snap">Snap包安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id6">命令后台运行</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id7">查看端口</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id8">防火墙</a></li>
<li class="toctree-l1"><a class="reference internal" href="#linux">linux 字符编码</a></li>
<li class="toctree-l1"><a class="reference internal" href="#dns">DNS 配置文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="#blog">创建自己的BLOG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sphinx">Sphinx生成网页</a></li>
<li class="toctree-l2"><a class="reference internal" href="#markdown">Markdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">修改主题</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pandoc">Pandoc格式转换</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id10">Linux 定时任务</a></li>
<li class="toctree-l1"><a class="reference internal" href="#mysql">mysql安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id11">mysql数据备份与恢复</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">mysql集群(多实例)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">什么是MySQL多实例</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">MySQL多实例的特点有以下几点</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">部署mysql多实例的两种方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">同一开发环境下安装多个数据库，必须处理以下问题</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id17">mysql多实例搭建</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mysqld-multi">mysqld_multi搭建</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id18">mysql主从复制</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#redis">安装Redis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id19">redis 持久化与发布订阅</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id20">发布订阅</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">持久化</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redisrdbaof">redis不重启之rdb数据切换到aof数据</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id22">redis 主从同步</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23">手动切换主从关系</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#redis-redis-sentinel">redis哨兵 Redis-Sentinel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#redis-redis-cluster">Redis集群 redis-cluster</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#mongodb">安装MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="#nginx">Nginx配置</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id24">Nginx反向代理</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id25">Nginx负载均衡</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#uwsgi">uWSGI配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="#supervisor">supervisor 进程管理工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="#nodejsnpm">安装nodejs、npm</a></li>
<li class="toctree-l1"><a class="reference internal" href="#git-clone">git clone 提速</a></li>
<li class="toctree-l1"><a class="reference internal" href="#systemback-ios">安装 systemback 备份IOS镜像</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#systemback4gubuntu">Systemback制作大于4G的Ubuntu系统镜像</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#fastdfs">FastDFS文件管理系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nginxfastdfs-nginx-module">安装nginx及fastdfs-nginx-module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#ubuntukms">Ubuntu搭建KMS服务器</a></li>
<li class="toctree-l1"><a class="reference internal" href="#ubuntu-docker">Ubuntu 安装Docker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id27">搭建Nginx</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id28">搭建Mysql</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id29">搭建Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id30">搭建MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sentry">搭建Sentry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#elasticsearch">搭建elasticsearch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="django_restframework.html">django restframework</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Li's BLOG</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Ubuntu 18.04 server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Ubuntu_18.04_server.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ubuntu-18-04-server">
<h1>Ubuntu 18.04 server<a class="headerlink" href="#ubuntu-18-04-server" title="永久链接至标题">¶</a></h1>
</div>
<div class="section" id="apt">
<h1>修改 apt 软件源为阿里云的源<a class="headerlink" href="#apt" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>复制源文件备份，以防万一</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo cp /etc/apt/sources.list /etc/apt/sources.list.back
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>编辑源列表文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 清空list</span>
<span class="nb">echo</span> &gt; /etc/apt/sources.list
sudo vim /etc/apt/sources.list

<span class="c1">#将原有的内容注释掉，添加以下内容</span>
deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>添加elementaryos软件源</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo wget -O - http://package.elementaryos.cn/bionic/key/package.gpg.key <span class="p">|</span> sudo apt-key add -

sudo <span class="nb">echo</span> <span class="s1">&#39;deb http://package.elementaryos.cn/bionic/ bionic main&#39;</span> &gt;&gt; /etc/apt/sources.list
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>更新软件源</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get update<span class="o">&amp;&amp;</span>sudo apt-get upgrade<span class="o">&amp;&amp;</span>sudo apt-get install -f
</pre></div>
</div>
</div>
<div class="section" id="root">
<h1>设置root密码<a class="headerlink" href="#root" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo passwd root
<span class="c1">## 输入两次密码</span>
</pre></div>
</div>
</div>
<div class="section" id="sudo">
<h1>关闭sudo密码<a class="headerlink" href="#sudo" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo visudo

<span class="c1"># %sudo ALL=(ALL:ALL) ALL</span>
%sudo <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> NOPASSWD:ALL
</pre></div>
</div>
</div>
<div class="section" id="utc">
<h1>关闭UTC时间同步(双系统)<a class="headerlink" href="#utc" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>timedatectl set-local-rtc <span class="m">1</span> --adjust-system-clock
</pre></div>
</div>
</div>
<div class="section" id="zsh-oh-my-zsh">
<h1>安装<strong>安装 zsh 和 oh-my-zsh</strong><a class="headerlink" href="#zsh-oh-my-zsh" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat /etc/shells

<span class="c1"># 安装 zsh</span>
apt install zsh

<span class="c1"># 将 zsh 设置为系统默认 shell</span>
<span class="c1"># sudo chsh -s /bin/zsh</span>
chsh -s <span class="k">$(</span>which zsh<span class="k">)</span>

<span class="c1"># 自动安装，如果你没安装 git 需要先安装 git</span>
wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - <span class="p">|</span> sh

<span class="c1"># 或者也可以选择手动安装</span>
git clone git://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh
cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc
</pre></div>
</div>
<div class="section" id="zsh">
<h2>ZSH 配置<a class="headerlink" href="#zsh" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vim ~/.zshrc

<span class="nb">alias</span> <span class="nv">cls</span><span class="o">=</span><span class="s1">&#39;clear&#39;</span>
<span class="nb">alias</span> <span class="nv">ll</span><span class="o">=</span><span class="s1">&#39;ls -l&#39;</span>
<span class="nb">alias</span> <span class="nv">la</span><span class="o">=</span><span class="s1">&#39;ls -a&#39;</span>
<span class="nb">alias</span> <span class="nv">vi</span><span class="o">=</span><span class="s1">&#39;vim&#39;</span>
<span class="nb">alias</span> <span class="nv">grep</span><span class="o">=</span><span class="s2">&quot;grep --color=auto&quot;</span>

<span class="c1"># 或者选择 zsh 的主题</span>
<span class="c1"># oh-my-zsh 内置了很多主题，对应的主题文件存放在 ~/.oh-my-zsh/themes 目录下，你可以根据自己的喜好选择或者编辑主题。</span>
<span class="nv">ZSH_THEME</span><span class="o">=</span><span class="s2">&quot;robbyrussell&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2>ZSH 插件安装<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>oh-my-zsh 还支持各种插件，存放在 ~/.oh-my-zsh/plugins
目录下。这里推荐几款：</p>
<ul class="simple">
<li><p>autojump：快速切换目录插件</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 安装</span>
apt install autojump

<span class="c1"># 使用</span>
j Document/
</pre></div>
</div>
<ul class="simple">
<li><p>zsh-autosuggestions：命令行命令键入时的历史命令建议插件</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 安装</span>
git clone https://github.com/zsh-users/zsh-autosuggestions <span class="si">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="si">}</span>/plugins/zsh-autosuggestions
</pre></div>
</div>
<ul class="simple">
<li><p>zsh-syntax-highlighting：命令行语法高亮插件</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 安装</span>
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="si">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="si">}</span>/plugins/zsh-syntax-highlighting

插件安装好后需要在 ~/.zshrc 文件里配置后方可使用，配置如下：
<span class="c1"># 打开 ~/.zshrc 文件，找到如下这行配置代码，在后面追加插件名</span>
<span class="nv">plugins</span><span class="o">=(</span>其他插件名 autojump zsh-autosuggestions zsh-syntax-highlighting<span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="xshell">
<h1>xshell上传下载文件<a class="headerlink" href="#xshell" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt install  lrzsz -y
ps -ef <span class="p">|</span>grep lrzsz
rz <span class="c1">#本地上传服务器</span>
sz filepath <span class="c1">#sz pro_cel.rar</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h1>安装压缩包<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h1>
<p>1、压缩功能 安装 sudo apt-get install rar 卸载 sudo apt-get remove rar
2、解压功能 安装 sudo apt-get install unrar 卸载 sudo apt-get remove
unrar 压缩解压缩.rar 解压：rar x FileName.rar 压缩：rar a FileName.rar
DirName</p>
<p>一、.tar</p>
<p>解包：tar xvf FileName.tar -C 路径</p>
<p>打包：tar cvf FileName.tar DirName</p>
<p>（注：tar是打包，不是压缩！）</p>
<p>二、.gz</p>
<p>解压1：gunzip FileName.gz</p>
<p>解压2：gzip -d FileName.gz</p>
<p>压缩：gzip FileName</p>
<p>.tar.gz</p>
<p>解压：tar zxvf FileName.tar.gz</p>
<p>压缩：tar zcvf FileName.tar.gz DirName</p>
<p>三、.bz2</p>
<p>解压1：bzip2 -d FileName.bz2</p>
<p>解压2：bunzip2 FileName.bz2</p>
<p>压缩： bzip2 -z FileName</p>
<p>.tar.bz2</p>
<p>解压：tar jxvf FileName.tar.bz2</p>
<p>压缩：tar jcvf FileName.tar.bz2 DirName</p>
<p>三、.bz</p>
<p>解压1：bzip2 -d FileName.bz</p>
<p>解压2：bunzip2 FileName.bz</p>
<p>.tar.bz</p>
<p>解压：tar jxvf FileName.tar.bz</p>
<p>四、.Z</p>
<p>解压：uncompress FileName.Z</p>
<p>压缩：compress FileName</p>
<p>.tar.Z</p>
<p>解压：tar Zxvf FileName.tar.Z</p>
<p>压缩：tar Zcvf FileName.tar.Z DirName</p>
<p>五、.tgz</p>
<p>解压：tar zxvf FileName.tgz</p>
<p>.tar.tgz</p>
<p>解压：tar zxvf FileName.tar.tgz</p>
<p>压缩：tar zcvf FileName.tar.tgz FileName</p>
<p>六、.zip</p>
<p>解压：unzip FileName.zip</p>
<p>压缩：zip FileName.zip DirName</p>
<p>七、.rar</p>
<p>解压：rar a FileName.rar</p>
<p>压缩：rar e FileName.rar</p>
<p>八、.lha</p>
<p>解压：lha -e FileName.lha</p>
<p>压缩：lha -a FileName.lha FileName</p>
</div>
<div class="section" id="id3">
<h1>配置全局环境变量<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h1>
<p>查看PATH：echo
<span class="math notranslate nohighlight">\(PATH 以添加mongodb server为列 修改方法一： export PATH=/usr/local/mongodb/bin:\)</span>PATH
//配置完后可以通过echo $PATH查看配置结果。 生效方法：立即生效
有效期限：临时改变，只能在当前的终端窗口中有效，当前窗口关闭后就会恢复原有的path配置
用户局限：仅对当前用户</p>
<p>修改方法二： 通过修改.bashrc文件: vim ~/.bashrc //在最后一行添上：
export PATH=/usr/local/mongodb/bin:$PATH 生效方法：（有以下两种）
1、关闭当前终端窗口，重新打开一个新终端窗口就能生效 2、输入“source
~/.bashrc”命令，立即生效 有效期限：永久有效 用户局限：仅对当前用户</p>
<p>修改方法三: 通过修改profile文件: vim /etc/profile /export PATH
//找到设置PATH的行，添加 export PATH=/usr/local/mongodb/bin:$PATH
生效方法：系统重启 有效期限：永久有效 用户局限：对所有用户</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加环境变量</span>
<span class="nb">echo</span> <span class="s1">&#39;export PATH=$PATH:/usr/local/mongodb/bin&#39;</span> &gt;&gt;  /etc/profile
<span class="nb">source</span> /etc/profile
</pre></div>
</div>
<p>修改方法四: 通过修改environment文件: vim /etc/environment
在PATH=”/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games”中加入“:/usr/local/mongodb/bin”
生效方法：系统重启 有效期限：永久有效 用户局限：对所有用户</p>
<div class="section" id="id4">
<h2>创建软链接<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ln -s /usr/local/python3/bin/python3.7 /usr/bin/python3

ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3
</pre></div>
</div>
</div>
</div>
<div class="section" id="scp">
<h1>scp传输文件<a class="headerlink" href="#scp" title="永久链接至标题">¶</a></h1>
<p>scp [参数] : :</p>
<p>参数:</p>
<p>-r 传输文件夹</p>
<p>-v 展示传输详情</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>scp /home/soft/jdk-7u55-linux-i586.tar.gz root@192.168.132.132:/

scp -r /home/soft root@192.168.132.132:/
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h1>配置桌面快捷方式<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h1>
<p>创建desktop文件</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vim Postman.desktop

<span class="o">[</span>Desktop Entry<span class="o">]</span>
<span class="nv">Encoding</span><span class="o">=</span>UTF-8
<span class="nv">Name</span><span class="o">=</span>Postman
<span class="nv">Exec</span><span class="o">=</span>/opt/Postman/Postman/Postman
<span class="nv">Icon</span><span class="o">=</span>/opt/Postman/Postman/app/resources/app/assets/icon.png
<span class="nv">Terminal</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">Type</span><span class="o">=</span>Application
<span class="nv">Categories</span><span class="o">=</span>Development<span class="p">;</span>

sudo cp Postman.desktop /usr/share/applications/
</pre></div>
</div>
</div>
<div class="section" id="rmpdeb">
<h1>rmp格式安装包转deb<a class="headerlink" href="#rmpdeb" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加 Universe 仓库（如果未添加）</span>
sudo add-apt-repository universe

<span class="c1"># 更新</span>
sudo apt update

<span class="c1"># 安装 Alien</span>
sudo apt install alien

<span class="c1"># 将.rpm 包转换为.deb 包</span>
<span class="c1">#（当前目录下会生成一个 deb 安装包，比如: XMind-2020.deb）</span>
sudo alien XMind-2020.rpm

<span class="c1"># 安装</span>
sudo dpkg -i XMind-2020.deb
</pre></div>
</div>
</div>
<div class="section" id="gnome">
<h1>安装GNOME桌面<a class="headerlink" href="#gnome" title="永久链接至标题">¶</a></h1>
<ol class="arabic">
<li><p>输入以下命令</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get install tasksel -y
sudo tasksel
</pre></div>
</div>
</li>
<li><p>选择Ubuntu desktop</p></li>
</ol>
<p><a class="reference external" href="https://blog.csdn.net/zhangtao_heu/article/details/81989147">https://blog.csdn.net/zhangtao_heu/article/details/81989147</a></p>
<ol class="arabic simple" start="3">
<li><p>如需安装LAMP选择LAMP server</p></li>
</ol>
</div>
<div class="section" id="python">
<h1>安装Python虚拟环境<a class="headerlink" href="#python" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>配置基本环境</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get install -y python3-pip
sudo apt-get install build-essential libssl-dev libffi-dev python-dev
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>安装venv</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt install virtualenv
sudo apt install virtualenvwrapper
pip3 install virtualenv
pip3 install virtualenvwrapper
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p>修改配置文件</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo vim ~/.bashrc
</pre></div>
</div>
<p>在.bashrc文件末尾添加两行： export WORKON_HOME=$HOME/.virtualenvs
source /usr/share/virtualenvwrapper/virtualenvwrapper.sh</p>
</li>
<li><p>启用配置文件</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/.bashrc
</pre></div>
</div>
</li>
<li><p>检查是否可以创建虚拟环境</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkvirtualenv Django -p /usr/bin/python3
<span class="c1"># 或者在~/.bashrc文件中设置环境变量VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2.7</span>
workon Django  激活虚拟环境
deactivate     注销当前已经被激活的虚拟环境
lsvirtualenv   显示已安装虚拟环境
rmvirtualenv   删除虚拟环境
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="pip">
<h1>pip 国内源<a class="headerlink" href="#pip" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install xxx -i https://pypi.douban.com/simple/
pip install -r requirements.txt -i https://pypi.douban.com/simple/
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir ~/.pip
vim ~/.pip/pip.conf
<span class="c1"># 然后将下面这两行复制进去就好了</span>
<span class="o">[</span>global<span class="o">]</span>
index-url <span class="o">=</span> https://mirrors.aliyun.com/pypi/simple
</pre></div>
</div>
<p>国内其他pip源</p>
<p>清华：<a class="reference external" href="https://pypi.tuna.tsinghua.edu.cn/simple">https://pypi.tuna.tsinghua.edu.cn/simple</a> 中国科技大学
<a class="reference external" href="https://pypi.mirrors.ustc.edu.cn/simple/">https://pypi.mirrors.ustc.edu.cn/simple/</a>
华中理工大学：<a class="reference external" href="http://pypi.hustunique.com/">http://pypi.hustunique.com/</a>
山东理工大学：<a class="reference external" href="http://pypi.sdutlinux.org/">http://pypi.sdutlinux.org/</a>
豆瓣：<a class="reference external" href="http://pypi.douban.com/simple/">http://pypi.douban.com/simple/</a></p>
<p>注意：不管你用的是pip3还是pip，方法都是一样的，都是创建pip文件夹。</p>
</div>
<div class="section" id="snap">
<h1>Snap包安装<a class="headerlink" href="#snap" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo snap install picgo.snap --dangerous
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h1>命令后台运行<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h1>
<p>这种命令要满足1.要运行一段时间2.不需要与用户交互</p>
<p>命令在后台运行 命令 &amp; 这种会绑定终端，终端一关，进程结束</p>
<p>ctrl+Z 放到后台暂停</p>
<p>将命令放到/etc/rc.local中，系统启动时执行里面命令，因不是终端启动所以不受影响</p>
<p>脱离终端，关了终端也可运行 nohup 命令 &amp;</p>
</div>
<div class="section" id="id7">
<h1>查看端口<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ps -ef<span class="p">|</span>grep <span class="m">8000</span>
netstat -tunlp<span class="p">|</span>grep <span class="m">8000</span>
<span class="c1"># netstat -apn | grep 8000</span>
<span class="nb">kill</span> -9 <span class="m">4438</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h1>防火墙<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h1>
<ul class="simple">
<li><p>selinux 内置防火墙</p></li>
</ul>
<ol class="arabic simple">
<li><p>查询selinux状态 getenforce</p></li>
<li><p>暂时停止selinux setenforce 0</p></li>
<li><p>永久关闭selinux vim /etc/selinux/conf SELINUX=disabled</p></li>
</ol>
<ul class="simple">
<li><p>软件防火墙iptables iptables -F #清空规则 iptables -L
#查看iptables防火墙规则</p></li>
<li><p>停止防火墙服务 systemctl start/restart/stop firewalld systemctl
disable firewalld #停止iptables的开机自启</p></li>
</ul>
</div>
<div class="section" id="linux">
<h1>linux 字符编码<a class="headerlink" href="#linux" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>编辑字符编码文件 vim /etc/locale.conf</p></li>
<li><p>写入如下变量 LANG=”zh_CN.UTF-8”</p></li>
<li><p>读取文件是变量生效 source /etc/locale.conf</p></li>
<li><p>查看系统变量 echo $LANG</p></li>
</ol>
</div>
<div class="section" id="dns">
<h1>DNS 配置文件<a class="headerlink" href="#dns" title="永久链接至标题">¶</a></h1>
<p>vim /etc/resolv.conf</p>
<p>nameserver 119.29.29.29 nameserver 223.5.5.5</p>
<p>/etc/hosts #本地dns强制解析域名文件</p>
<p>nslookup</p>
</div>
<div class="section" id="blog">
<h1>创建自己的BLOG<a class="headerlink" href="#blog" title="永久链接至标题">¶</a></h1>
<div class="section" id="sphinx">
<h2><a class="reference external" href="http://sphinx-doc.org/">Sphinx</a>生成网页<a class="headerlink" href="#sphinx" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>安装Sphinx</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install sphinx sphinx-autobuild sphinx_rtd_theme
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>创建一个工程项目</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir docs
cd docs
sphinx-quickstart

# 其他按照默认设置
Project name: LHM&#39;s BLOG
Author name(s): LHM
Project release []: 1.0
Project language [en]: zh_CN

tree
...
index.rst   #index文件
conf.py      #配置文件
...

# 生成html
make html
</pre></div>
</div>
</div>
<div class="section" id="markdown">
<h2>Markdown<a class="headerlink" href="#markdown" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>安装recommonmark</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install recommonmark
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>在conf.py添加下面内容</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">recommonmark.parser</span> <span class="kn">import</span> <span class="n">CommonMarkParser</span>

<span class="n">source_parsers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;.md&#39;</span><span class="p">:</span> <span class="n">CommonMarkParser</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">source_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.rst&#39;</span><span class="p">,</span> <span class="s1">&#39;.md&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h2>修改主题<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>import sphinx_rtd_theme

<span class="nv">html_theme</span> <span class="o">=</span> <span class="s1">&#39;sphinx_rtd_theme&#39;</span>
<span class="nv">html_theme_path</span> <span class="o">=</span> <span class="o">[</span>sphinx_rtd_theme.get_html_theme_path<span class="o">()]</span>
</pre></div>
</div>
</div>
<div class="section" id="pandoc">
<h2>Pandoc格式转换<a class="headerlink" href="#pandoc" title="永久链接至标题">¶</a></h2>
<p>markdown文件转换rst</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pandoc -V <span class="nv">mainfont</span><span class="o">=</span><span class="s2">&quot;SimSun&quot;</span> -f markdown -t rst Ubuntu_18.04_server.md -o Ubuntu_18.04_server.rst
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h1>Linux 定时任务<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h1>
<ol class="arabic">
<li><p>查看crontab crontab -l</p></li>
<li><p>编辑crontab crontab -e</p></li>
<li><p>编辑配置文件 vim /etc/crontab</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example of job definition:</span>
<span class="c1"># .---------------- minute (0 - 59)</span>
<span class="c1"># |  .------------- hour (0 - 23)</span>
<span class="c1"># |  |  .---------- day of month (1 - 31)</span>
<span class="c1"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="c1"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="c1"># |  |  |  |  |</span>
<span class="c1"># *  *  *  *  * user-name  command to be executed #命令必须绝对路径</span>
  分 时 日  月 周
  <span class="m">0</span>  <span class="m">0</span> <span class="m">1</span>   *  * /usr/bin/systemctl restart nginx
  每月1日0点重启nginx
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="mysql">
<h1>mysql安装<a class="headerlink" href="#mysql" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>使用apt get 命令即可安装MySQL</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get install -y mysql-server mysql-client
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>启动、关闭和重启MySQL 服务的命令如下</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo service mysql start
sudo service mysql stop
sudo service mysql restart
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>初始化</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysql_secure_installation

Enter current password <span class="k">for</span> root <span class="o">(</span>entry <span class="k">for</span> none<span class="o">)</span>:entry
Set root password? Y  <span class="c1">#设置root密码</span>
Remove anonymous users? Y  <span class="c1">#删除匿名用户</span>
Disallow root login remotely? n  <span class="c1">#允许远程登陆</span>
Remove <span class="nb">test</span> database and access to it? Y <span class="c1">#删除测试数据库</span>
Reload privilege tables now? Y <span class="c1">#重新加载权限表</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>因为安装的过程中没让设置密码，可能密码为空，但无论如何都进不去mysql</p></li>
<li><p>修改配置文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
配置文件中的<span class="o">[</span>mysqld<span class="o">]</span>这一块中加入
character-set-server<span class="o">=</span>utf8
collation-server<span class="o">=</span>utf8_general_ci
skip-grant-tables

service mysql restart  重新启动mysql
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>修改mysql root密码</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysql -u root -p    遇见输入密码的提示直接回车即可,进入mysql

use mysql<span class="p">;</span>
update user <span class="nb">set</span> <span class="nv">authentication_string</span><span class="o">=</span>password<span class="o">(</span><span class="s2">&quot;你的密码&quot;</span><span class="o">)</span> where <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="p">;</span>
flush privileges<span class="p">;</span>
<span class="k">select</span> user,plugin from user<span class="p">;</span>
<span class="c1"># 如果plugin=&#39;auth_socket&#39;</span>
update user <span class="nb">set</span> <span class="nv">plugin</span><span class="o">=</span><span class="s1">&#39;mysql_native_password&#39;</span> where <span class="nv">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
<span class="k">select</span> user,host from user<span class="p">;</span>
<span class="c1"># 如果host=&#39;localhost&#39;</span>
update user <span class="nb">set</span> <span class="nv">host</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span> where <span class="nv">user</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">;</span>  远程连接
     quit       退出mysql
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>注释配置文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
<span class="c1">#  skip-grant-tables</span>

<span class="c1"># bind-address  = 127.0.0.1   远程连接</span>
service mysql restart  重新启动mysql
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>创建非root账号</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>-- 创建普通用户，权限非常低
create user uroot@<span class="s1">&#39;%&#39;</span> identified by <span class="s1">&#39;uroot&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>添加权限</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>-- 对所有库和所有表授权所有权限
grant all privileges on *.* to uroot@<span class="s1">&#39;%&#39;</span> <span class="p">;</span>
-- 授权root用户需identified 密码
grant all privileges on *.* to root@<span class="s1">&#39;%&#39;</span>  identified by <span class="s1">&#39;root&#39;</span><span class="p">;</span>
-- 刷新授权表
flush privileges<span class="p">;</span>
</pre></div>
</div>
<div class="section" id="id11">
<h2>mysql数据备份与恢复<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>导出数据库</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysqldump -u root -p --all-databases &gt; /data/AllMysql.dump
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>登录mysql 恢复数据库</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /data/AllMysql.dump<span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>或者命令行恢复数据库</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysql -uroot -p  &lt;  /data/AllMysql.dump
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h2>mysql集群(多实例)<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<div class="section" id="id13">
<h3>什么是MySQL多实例<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<p>MySQL多实例就是在一台机器上开启多个不同的服务端口（如：3306，3307，3308），运行多个MySQL服务进程，通过不同的socket监听不同的服务端口来提供各自的服务。</p>
</div>
<div class="section" id="id14">
<h3>MySQL多实例的特点有以下几点<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>有效利用服务器资源，当单个服务器资源有剩余时，可以充分利用剩余的资源提供更多的服务。</p></li>
<li><p>节约服务器资源</p></li>
<li><p>资源互相抢占问题，当某个服务实例服务并发很高时或者开启慢查询时，会消耗更多的内存、CPU、磁盘IO资源，导致服务器上的其他实例提供服务的质量下降；</p></li>
</ul>
</div>
<div class="section" id="id15">
<h3>部署mysql多实例的两种方式<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<p>第一种是使用<code class="docutils literal notranslate"><span class="pre">多个配置文件</span></code>启动不同的进程来实现多实例，这种方式的优势逻辑简单，配置简单，缺点是管理起来不太方便；</p>
<p>第二种是通过官方自带的<code class="docutils literal notranslate"><span class="pre">mysqld_multi</span></code>使用单独的配置文件来实现多实例，这种方式定制每个实例的配置不太方面，优点是管理起来很方便，集中管理；</p>
</div>
<div class="section" id="id16">
<h3>同一开发环境下安装多个数据库，必须处理以下问题<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>配置文件安装路径不能相同</p></li>
<li><p>数据库目录不能相同</p></li>
<li><p>启动脚本不能同名</p></li>
<li><p>端口不能相同</p></li>
<li><p>socket文件的生成路径不能相同</p></li>
</ul>
</div>
</div>
<div class="section" id="id17">
<h2>mysql多实例搭建<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h2>
<div class="section" id="mysqld-multi">
<h3>mysqld_multi搭建<a class="headerlink" href="#mysqld-multi" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>下载免编译二进制包</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wget http://mirrors.sohu.com/mysql/MySQL-5.7/mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz

tar -zxvf mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz
mv mysql-5.7.23-linux-glibc2.12-x86_64 /usr/local/mysql

<span class="c1"># 关闭iptables</span>
service iptables stop  <span class="c1">#临时关闭</span>
chkconfig iptables off  <span class="c1">#永久关闭</span>

<span class="c1"># 关闭selinux</span>
vi /etc/sysconfig/selinux
<span class="nv">SELINUX</span><span class="o">=</span>DISABLED

<span class="c1"># 创建mysql系统用户和组</span>
groupadd -g <span class="m">27</span> mysql
useradd -u <span class="m">27</span> -g mysql mysql
id mysql

<span class="c1"># 创建mysql目录</span>
mkdir -p /data/mysql/mysql_3306/data
mkdir -p /data/mysql/mysql_3306/log
mkdir -p /data/mysql/mysql_3306/tmp
mkdir -p /data/mysql/mysql_3307/data
mkdir -p /data/mysql/mysql_3307/log
mkdir -p /data/mysql/mysql_3307/tmp
mkdir -p /data/mysql/mysql_3308/data
mkdir -p /data/mysql/mysql_3308/log
mkdir -p /data/mysql/mysql_3308/tmp

<span class="c1"># 更改目录权限</span>
chown -R mysql:mysql /data/mysql/
chown -R mysql:mysql /usr/local/mysql/
<span class="c1"># 添加环境变量</span>
<span class="nb">echo</span> <span class="s1">&#39;export PATH=$PATH:/usr/local/mysql/bin&#39;</span> &gt;&gt;  /etc/profile
<span class="nb">source</span> /etc/profile

<span class="c1"># 复制my.cnf文件到etc目录 会将原来的my.cnf文件删除了</span>
cp /etc/my.cnf /etc/my.cnf.bak
cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>修改my.cnf（在一个文件中修改即可）</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vim /etc/my.conf

<span class="o">[</span>client<span class="o">]</span>
<span class="nv">port</span><span class="o">=</span><span class="m">3306</span>
<span class="nv">socket</span><span class="o">=</span>/tmp/mysql.sock

<span class="o">[</span>mysqld_multi<span class="o">]</span>
<span class="nv">mysqld</span> <span class="o">=</span> /usr/local/mysql/bin/mysqld_safe
<span class="nv">mysqladmin</span> <span class="o">=</span> /usr/local/mysql/bin/mysqladmin
<span class="nv">log</span> <span class="o">=</span> /data/mysql/mysqld_multi.log

<span class="o">[</span>mysqld<span class="o">]</span>
<span class="nv">basedir</span> <span class="o">=</span> /usr/local/mysql
<span class="nv">sql_mode</span><span class="o">=</span>NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES

<span class="c1">#3306数据库</span>

<span class="o">[</span>mysqld3306<span class="o">]</span>
<span class="nv">mysqld</span><span class="o">=</span>mysqld
<span class="nv">mysqladmin</span><span class="o">=</span>mysqladmin
<span class="nv">datadir</span><span class="o">=</span>/data/mysql/mysql_3306/data
<span class="nv">port</span><span class="o">=</span><span class="m">3306</span>
<span class="nv">server_id</span><span class="o">=</span><span class="m">3306</span>
<span class="nv">socket</span><span class="o">=</span>/tmp/mysql_3306.sock
log-output<span class="o">=</span>file
<span class="nv">slow_query_log</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">long_query_time</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">slow_query_log_file</span> <span class="o">=</span> /data/mysql/mysql_3306/log/slow.log
log-error <span class="o">=</span> /data/mysql/mysql_3306/log/error.log
<span class="nv">binlog_format</span> <span class="o">=</span> mixed
log-bin <span class="o">=</span> /data/mysql/mysql_3306/log/mysql3306_bin

<span class="c1">#3307数据库</span>

<span class="o">[</span>mysqld3307<span class="o">]</span>
<span class="nv">mysqld</span><span class="o">=</span>mysqld
<span class="nv">mysqladmin</span><span class="o">=</span>mysqladmin
<span class="nv">datadir</span><span class="o">=</span>/data/mysql/mysql_3307/data
<span class="nv">port</span><span class="o">=</span><span class="m">3307</span>
<span class="nv">server_id</span><span class="o">=</span><span class="m">3307</span>
<span class="nv">socket</span><span class="o">=</span>/tmp/mysql_3307.sock
log-output<span class="o">=</span>file
<span class="nv">slow_query_log</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">long_query_time</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">slow_query_log_file</span> <span class="o">=</span> /data/mysql/mysql_3307/log/slow.log
log-error <span class="o">=</span> /data/mysql/mysql_3307/log/error.log
<span class="nv">binlog_format</span> <span class="o">=</span> mixed
log-bin <span class="o">=</span> /data/mysql/mysql_3307/log/mysql3307_bin

<span class="c1">#3308数据库</span>

<span class="o">[</span>mysqld3308<span class="o">]</span>
<span class="nv">mysqld</span><span class="o">=</span>mysqld
<span class="nv">mysqladmin</span><span class="o">=</span>mysqladmin
<span class="nv">datadir</span><span class="o">=</span>/data/mysql/mysql_3308/data
<span class="nv">port</span><span class="o">=</span><span class="m">3308</span>
<span class="nv">server_id</span><span class="o">=</span><span class="m">3308</span>
<span class="nv">socket</span><span class="o">=</span>/tmp/mysql_3308.sock
log-output<span class="o">=</span>file
<span class="nv">slow_query_log</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">long_query_time</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">slow_query_log_file</span> <span class="o">=</span> /data/mysql/mysql_3308/log/slow.log
log-error <span class="o">=</span> /data/mysql/mysql_3308/log/error.log
<span class="nv">binlog_format</span> <span class="o">=</span> mixed
log-bin <span class="o">=</span> /data/mysql/mysql_3308/log/mysql3308_bin
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>初始化数据库</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 初始化3306数据库</span>
/usr/local/mysql/scripts/mysql_install_db --basedir<span class="o">=</span>/usr/local/mysql/ --datadir<span class="o">=</span>/data/mysql/mysql_3306/data --defaults-file<span class="o">=</span>/etc/my.cnf

/usr/local/mysql/scripts/mysql_install_db --basedir<span class="o">=</span>/usr/local/mysql/ --datadir<span class="o">=</span>/data/mysql/mysql_3307/data --defaults-file<span class="o">=</span>/etc/my.cnf

/usr/local/mysql/scripts/mysql_install_db --basedir<span class="o">=</span>/usr/local/mysql/ --datadir<span class="o">=</span>/data/mysql/mysql_3308/data --defaults-file<span class="o">=</span>/etc/my.cnf
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>查看数据库初始化是否成功</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data/mysql/mysql_3306/data/
<span class="nb">cd</span> /data/mysql/mysql_3307/data/
<span class="nb">cd</span> /data/mysql/mysql_3308/data/
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>设置启动文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>mysqld_multi进行多实例管理</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>启动全部实例：/usr/local/mysql/bin/mysqld_multi start

查看全部实例状态：/usr/local/mysql/bin/mysqld_multi report

启动单个实例：/usr/local/mysql/bin/mysqld_multi start <span class="m">3306</span>

停止单个实例：/usr/local/mysql/bin/mysqld_multi stop <span class="m">3306</span>

查看单个实例状态：/usr/local/mysql/bin/mysqld_multi report <span class="m">3306</span>

<span class="c1"># 启动全部实例</span>
/usr/local/mysql/bin/mysqld_multi start
/usr/local/mysql/bin/mysqld_multi report

<span class="c1"># 查看启动进程</span>
ps -aux <span class="p">|</span> grep mysql

<span class="c1"># 查看sock文件</span>
<span class="nb">cd</span> /tmp
ls mysql*.sock

<span class="c1"># 修改密码</span>
mysql -S /tmp/mysql_3306.sock
<span class="nb">set</span> password <span class="k">for</span> root@<span class="s1">&#39;localhost&#39;</span><span class="o">=</span>password<span class="o">(</span><span class="s1">&#39;xxxxxx&#39;</span><span class="o">)</span><span class="p">;</span>
flush privileges<span class="p">;</span>

<span class="c1"># 新建用户及授权</span>
grant ALL PRIVILEGES on *.* to admin@<span class="s1">&#39;%&#39;</span> identified by <span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
flush privileges
</pre></div>
</div>
</div>
</div>
<div class="section" id="id18">
<h2>mysql主从复制<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>设置master主库的配置文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
配置文件中的<span class="o">[</span>mysqld<span class="o">]</span>这一块中加入
server-id<span class="o">=</span><span class="m">1</span>  <span class="c1">#标注 主库的身份id</span>
log-bin<span class="o">=</span>mysql-bin  <span class="c1">#binlog的文件名</span>

service mysql restart  重新启动mysql

<span class="c1"># 查看主库的状态,日志文件的名字及数据起始位置</span>
show master status<span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>创建用于主从数据同步的账号</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">user</span> <span class="s1">&#39;slace_copy&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span> <span class="n">identified</span> <span class="k">by</span> <span class="s1">&#39;P@ssw0rd&#39;</span><span class="p">;</span>

<span class="c1">-- 授予主从同步账号的复制数据权限</span>
<span class="k">grant</span> <span class="n">replication</span> <span class="n">slave</span> <span class="k">on</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="k">to</span> <span class="s1">&#39;slace_copy&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>

<span class="c1">--进行数据库的锁表，防止数据写入</span>
<span class="n">flush</span> <span class="k">table</span> <span class="k">with</span> <span class="k">read</span> <span class="k">lock</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>将数据导出</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysqldump</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">-</span><span class="n">p</span> <span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">databases</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">zhucong</span><span class="o">.</span><span class="n">dump</span>

<span class="n">scp</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">zhucong</span><span class="o">.</span><span class="n">dump</span>   <span class="n">root</span><span class="nd">@slace_ip</span><span class="p">:</span><span class="o">/</span><span class="n">data</span><span class="o">/</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>登录slace从库导入主库数据，保持数据一致性</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysql -uroot -p
<span class="nb">source</span> /data/zhucong.dump
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>从库配置</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
配置文件中的<span class="o">[</span>mysqld<span class="o">]</span>这一块中加入
server-id<span class="o">=</span><span class="m">2</span>  <span class="c1">#标注 从库的身份id</span>

service mysql restart  重新启动mysql

show variables like <span class="s1">&#39;server_id&#39;</span><span class="p">;</span>
show variables like <span class="s1">&#39;log_bin&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>通过一条命令，开启主从同步</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>change master to <span class="nv">master_host</span><span class="o">=</span><span class="s1">&#39;192.168.129.128&#39;</span>,
<span class="nv">master_user</span><span class="o">=</span><span class="s1">&#39;slace_copy&#39;</span>,
<span class="nv">master_password</span><span class="o">=</span><span class="s1">&#39;P@ssw0rd&#39;</span>,
<span class="nv">master_log_file</span><span class="o">=</span><span class="s1">&#39;mysql-bin.000001&#39;</span>,
<span class="nv">master_log_pos</span><span class="o">=</span>位置<span class="p">;</span>   position值
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>开启从库的slave 同步</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>start slave<span class="p">;</span>
-- 查看slave IO、SQL Running Yes
show slave status<span class="se">\G</span><span class="p">;</span>

-- 如果Slave_SQL_Running：no
stop slave<span class="p">;</span>
SET GLOBAL <span class="nv">SQL_SLAVE_SKIP_COUNTER</span><span class="o">=</span><span class="m">1</span><span class="p">;</span>
start slave<span class="p">;</span>
show slave status<span class="se">\G</span><span class="p">;</span>
-- 如果Slave_IO_Running：no
slave stop<span class="p">;</span>
CHANGE MASTER TO <span class="nv">MASTER_LOG_FILE</span><span class="o">=</span><span class="s1">&#39;mysql-bin.000001&#39;</span>, <span class="nv">MASTER_LOG_POS</span><span class="o">=</span>位置<span class="p">;</span>
start slave<span class="p">;</span>
show slave status<span class="se">\G</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>解锁主库表</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>unlock tables<span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="redis">
<h1>安装Redis<a class="headerlink" href="#redis" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>安装Redis</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get -y install redis-server
redis-cli    可以进入就说安装成功
sudo vim /etc/redis/redis.conf
<span class="c1"># bind-address  = 127.0.0.1   远程连接</span>
<span class="c1"># requirepass foobared        Redis 设置密码</span>
protected-mode  no           无密码登录
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>重启、停止和启动 Redis服务</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo /etc/init.d/redis-server restart
sudo /etc/init.d/redis-server stop
sudo /etc/init.d/redis-server start
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>源码安装redis</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wget http://download.redis.io/releases/redis-4.0.10.tar.gz

tar -zxvf redis-4.0.10.tar.gz
<span class="nb">cd</span> redis-4.0.10
make <span class="o">&amp;&amp;</span> make install

vim /opt/redis-4.0.10/redis.conf
daemonize yes   <span class="c1">#后台启动</span>
<span class="nb">bind</span> <span class="m">0</span>.0.0.0
port <span class="m">6380</span>
requirepass P@ssw0rd
<span class="c1"># 启动服务</span>
redis-server redis.conf

<span class="c1"># 客户端登录密码</span>
redis-cli -p <span class="m">6380</span>
auth P@ssw0rd
<span class="c1"># -a参数登录，密码暴露这终端可能不安全</span>
redis-cli -p <span class="m">6380</span> -a P@ssw0rd
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>过滤空白行和注释行</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo grep -v <span class="s2">&quot;^#&quot;</span> /etc/redis/redis.conf <span class="p">|</span> grep -v <span class="s2">&quot;^</span>$<span class="s2">&quot;</span>
</pre></div>
</div>
<div class="section" id="id19">
<h2>redis 持久化与发布订阅<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h2>
<div class="section" id="id20">
<h3>发布订阅<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>发布者 PUBLISH PUBLISH music reidslearn 给频道music发布消息</p></li>
<li><p>接受者 SUBSCRIBE SUBSCRIBE music 订阅music频道 PSUBSCRIBE 频道*
支持模糊订阅频道</p></li>
<li><p>频道 music</p></li>
</ul>
</div>
<div class="section" id="id21">
<h3>持久化<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>RDB持久化(数据快照)</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># rdb.conf</span>
daemonize yes   <span class="c1">#后台启动</span>
<span class="nb">bind</span> <span class="m">0</span>.0.0.0
port <span class="m">6379</span>
requirepass P@ssw0rd
logfile /data/6379/redis.log
dir /data/6379
dbfilename  dump.rdb
save <span class="m">900</span> <span class="m">1</span>                              <span class="c1">#每900秒 有1个修改记录</span>
save <span class="m">300</span> <span class="m">10</span>                           <span class="c1">#每300秒 有10个修改记录</span>
save <span class="m">60</span> <span class="m">10000</span>                       <span class="c1">#每60秒 有10000个修改记录</span>
</pre></div>
</div>
<ul class="simple">
<li><p>AOF持久化</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># aof.conf</span>
daemonize yes   <span class="c1">#后台启动</span>
<span class="nb">bind</span> <span class="m">0</span>.0.0.0
port <span class="m">6379</span>
requirepass P@ssw0rd
logfile /data/6379/redis.log
dir /data/6379

appendonly yes
appendfsync always <span class="c1">#总是修改类的操作</span>
                            everysec <span class="c1">#每秒做一次持久化</span>
                            no <span class="c1">#依赖于系统自带的缓存大小机制</span>

<span class="c1"># 查看aof文件变化</span>
tail -f appendonly.aof
</pre></div>
</div>
</div>
<div class="section" id="redisrdbaof">
<h3>redis不重启之rdb数据切换到aof数据<a class="headerlink" href="#redisrdbaof" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>准备rdb的redis服务端 redis-server rdb.conf</p></li>
<li><p>切换rdb到aof</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>redis-cli <span class="c1">#登录redis</span>
CONFIG SET appendonly yes  <span class="c1">#用命令激活aof持久化(临时生效，注意写到配置文件)</span>
CONFIG SET save <span class="s2">&quot;&quot;</span>  <span class="c1">#关闭rdb持久化</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vim rdb.conf
daemonize yes   <span class="c1">#后台启动</span>
<span class="nb">bind</span> <span class="m">0</span>.0.0.0
port <span class="m">6379</span>
requirepass P@ssw0rd
logfile /data/6379/redis.log
dir /data/6379
<span class="c1">#dbfilename  dump.rdb</span>
<span class="c1">#save 900 1                             #每900秒 有1个修改记录</span>
<span class="c1">#save 300 10                              #每300秒 有10个修改记录</span>
<span class="c1">#save 60 10000</span>

appendonly yes
appendfsync everysec
</pre></div>
</div>
<ul class="simple">
<li><p>测试aof数据持久化</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">kill</span> -9 进程号
<span class="c1"># pkill redis-server   根据服务名杀死进程，可以杀死所有有关redis-server</span>
redis-server rdb.conf
</pre></div>
</div>
</div>
</div>
<div class="section" id="id22">
<h2>redis 主从同步<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>准备三个.conf 文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>touch redis-6379.conf
touch redis-6380.conf
touch redis-6381.conf

<span class="c1"># redis-6379.conf</span>
daemonize yes   <span class="c1">#后台启动</span>
port <span class="m">6379</span>
pidfile /data/6379/redis.pid
loglevel notice
logfile <span class="s2">&quot;/data/6379/redis.log&quot;</span>
dbfilename dump.rdb
dir /data/6379

<span class="c1"># sed -i 替换当前文件  s:替换  6379 被替换者 6380 替换为 g:全局 写到&gt;redis-6380.conf</span>
sed <span class="s2">&quot;s/6379/6380/g&quot;</span> redis-6379.conf &gt; redis-6380.conf
sed <span class="s2">&quot;s/6379/6381/g&quot;</span> redis-6379.conf &gt; redis-6381.conf
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>配置主从关系</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;slaveof 127.0.0.1 6379&quot;</span> &gt;&gt; redis-6380.conf
<span class="nb">echo</span> <span class="s2">&quot;slaveof 127.0.0.1 6379&quot;</span> &gt;&gt; redis-6381.conf
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>开启三个服务</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>redis-server redis-6379.conf
redis-server redis-6380.conf
redis-server redis-6381.conf
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>查看info</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>redis-cli -p <span class="m">6379</span> info <span class="o">[</span>replication<span class="o">]</span>
</pre></div>
</div>
<div class="section" id="id23">
<h3>手动切换主从关系<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 杀死6379的主库实例</span>
<span class="nb">kill</span> - <span class="m">9</span> 主库PID

<span class="c1"># 手动切换主从身份</span>
    <span class="c1"># 登录redis-6380,通过命令，去掉自己的从库身份,等待连接</span>
    slaveof no one

    <span class="c1"># 登录redis-6381,通过命令，生成新的主人</span>
    slaveof <span class="m">127</span>.0.0.1 <span class="m">6380</span>
<span class="c1"># 测试新的主从数据同步</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="redis-redis-sentinel">
<h2>redis哨兵 Redis-Sentinel<a class="headerlink" href="#redis-redis-sentinel" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>什么是哨兵呢？保护redis主从集群，正常运转，当主库挂掉之后，自动的在从库中挑选新的主库，进行同步数据</p></li>
<li><p>准备三个redis数据库实例</p></li>
<li><p>准备三个哨兵配置文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>touch redis-sentinel-26379.conf
touch redis-sentinel-26380.conf
touch redis-sentinel-26381.conf

<span class="c1"># redis-sentinel-26379.conf</span>
daemonize yes   <span class="c1">#后台启动</span>
port <span class="m">26379</span>
dir /var/redis/data/
logfile <span class="s2">&quot;26379.log&quot;</span>

sentinel monitor mymater <span class="m">127</span>.0.0.1 <span class="m">6379</span> <span class="m">2</span>
sentinel down-after-milliseconds mymaster <span class="m">30000</span>
sentinel parallel-syncs mymaster <span class="m">1</span>
sentinel failover-timeout mymaster <span class="m">180000</span>


sed <span class="s2">&quot;s/6379/6380/g&quot;</span> redis-sentinel-26379.conf &gt; redis-sentinel-26380.conf
sed <span class="s2">&quot;s/6379/6381/g&quot;</span> redis-sentinel-26379.conf &gt; redis-sentinel-26381.conf
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>开启三个哨兵</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>reids-sentinel redis-sentinel-26379.conf
reids-sentinel redis-sentinel-26380.conf
reids-sentinel redis-sentinel-26381.conf
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>查看哨兵通信状态</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>reids-cli -p <span class="m">26379</span> info sentinel
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>杀死一个redis主库，6379节点，等待30s，检查6380和6381的节点状态</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">kill</span> <span class="m">6379</span> PID
reids-cli -p <span class="m">6380</span> info replication
reids-cli -p <span class="m">6381</span> info replication
<span class="c1"># 如果切换的主从身份之后，（原理就是 更改redis的配置文件，切换主从身份）</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>恢复6379数据库，查看是否将6379添加为新的slave身份</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>reids-cli -p <span class="m">6379</span> info replication
</pre></div>
</div>
</div>
<div class="section" id="redis-redis-cluster">
<h2>Redis集群 redis-cluster<a class="headerlink" href="#redis-redis-cluster" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>环境准备</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># redis-7000.conf</span>

port <span class="m">7000</span>
daemonize yes
dir <span class="s2">&quot;/opt/redis/data&quot;</span>
logfile <span class="s2">&quot;7000.log&quot;</span>
dbfilename <span class="s2">&quot;dump-7000.rdb&quot;</span>
cluster-enabled yes   <span class="c1">#开启集群模式</span>
cluster-config-file nodes-7000.conf　　<span class="c1">#集群内部的配置文件</span>
cluster-require-full-coverage no　　<span class="c1">#redis cluster需要16384个slot都正常的时候才能对外提供服务，换句话说，只要任何一个slot异常那么整个cluster不对外提供服务。 因此生产环境一般为no</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>redis支持多实例的功能，我们在单机演示集群搭建，需要6个实例，三个是主节点，三个是从节点，数量为6个节点才能保证高可用的集群。</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sed <span class="s2">&quot;s/7000/7001/g&quot;</span> redis-7000.conf &gt; redis-7001.conf
sed <span class="s2">&quot;s/7000/7002/g&quot;</span> redis-7000.conf &gt; redis-7002.conf
sed <span class="s2">&quot;s/7000/7003/g&quot;</span> redis-7000.conf &gt; redis-7003.conf
sed <span class="s2">&quot;s/7000/7004/g&quot;</span> redis-7000.conf &gt; redis-7004.conf
sed <span class="s2">&quot;s/7000/7005/g&quot;</span> redis-7000.conf &gt; redis-7005.conf
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>运行redis实例</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>redis-server redis-7000.conf
redis-server redis-7001.conf
redis-server redis-7002.conf
redis-server redis-7003.conf
redis-server redis-7004.conf
redis-server redis-7005.conf

<span class="c1"># 检查日志文件</span>
cat <span class="m">7000</span>.log
<span class="c1"># 检查redis服务的端口、进程</span>
ps -ef<span class="p">|</span>grep redis

<span class="c1"># 此时集群还不可用，可以通过登录redis查看</span>
redis-cli -p <span class="m">7000</span>
<span class="nb">set</span> hello world

<span class="o">(</span>error<span class="o">)</span>CLUSTERDOWN The cluster is down
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>准备ruby环境</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#下载ruby</span>
wget https://cache.ruby-lang.org/pub/ruby/2.3/ruby-2.3.1.tar.gz

<span class="c1">#安装ruby</span>
tar -xvf ruby-2.3.1.tar.gz
./configure --prefix<span class="o">=</span>/opt/ruby/
make <span class="o">&amp;&amp;</span> make install

<span class="c1">#准备一个ruby命令</span>
<span class="c1">#准备一个gem软件包管理命令</span>
<span class="c1">#拷贝ruby命令到path下/usr/local/ruby</span>
cp /opt/ruby/bin/ruby /usr/local/
cp bin/gem /usr/local/bin

<span class="c1"># 安装ruby gem 包管理工具</span>
wget http://rubygems.org/downloads/redis-3.3.0.gem

gem install -l redis-3.3.0.gem

<span class="c1"># 查看gem有哪些包</span>
gem list -- check redis gem

<span class="c1"># 安装redis-trib.rb命令</span>
cp /opt/redis/src/redis-trib.rb /usr/local/bin/
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>一键开启redis-cluster集群</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#每个主节点，有一个从节点，代表--replicas 1</span>
redis-trib.rb create --replicas <span class="m">1</span> <span class="m">127</span>.0.0.1:7000 <span class="m">127</span>.0.0.1:7001 <span class="m">127</span>.0.0.1:7002 <span class="m">127</span>.0.0.1:7003 <span class="m">127</span>.0.0.1:7004 <span class="m">127</span>.0.0.1:7005

<span class="c1">#集群自动分配主从关系  7000、7001、7002为 7003、7004、7005 主动关系</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>查看集群状态</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>redis-cli -p <span class="m">7000</span> cluster info

redis-cli -p <span class="m">7000</span> cluster nodes  <span class="c1">#等同于查看nodes-7000.conf文件节点信息</span>

<span class="c1"># 集群主节点状态</span>
redis-cli -p <span class="m">7000</span> cluster nodes <span class="p">|</span> grep master
<span class="c1"># 集群从节点状态</span>
redis-cli -p <span class="m">7000</span> cluster nodes <span class="p">|</span> grep slave

<span class="c1"># 安装完毕后，检查集群状态</span>
redis-cli -p <span class="m">7000</span> cluster info
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>测试写入集群数据，登录集群必须使用redis-cli -c -p 7000必须加上-c参数</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>redis-cli -c -p <span class="m">7000</span>
<span class="nb">set</span> name li
keys *
get name
</pre></div>
</div>
</div>
</div>
<div class="section" id="mongodb">
<h1>安装MongoDB<a class="headerlink" href="#mongodb" title="永久链接至标题">¶</a></h1>
<p><a class="reference external" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/">官网安装链接</a></p>
<ol class="arabic simple">
<li><p>导入包管理系统使用的公钥</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc <span class="p">|</span> sudo apt-key add -
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>为MongoDB创建一个列表文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse&quot;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>重新加载本地包数据库</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>安装MongoDB包</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get install -y mongodb-org

<span class="c1"># /data/db  chmod 777</span>
mongod --port <span class="m">27017</span> -- dbpath /data/db
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>mongo创建管理员</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mongo --port <span class="m">27017</span>
use admin
db.createUser<span class="o">({</span>user:<span class="s2">&quot;root&quot;</span>,pwd:<span class="s2">&quot;root&quot;</span>,roles:<span class="o">[</span><span class="s2">&quot;userAdminAnyDatabase&quot;</span><span class="o">]})</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>配置文件设置</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo vim /etc/mongod.conf

net:
    port:27017
    bindIp:0.0.0.0

<span class="c1"># 无密码登录无需配置</span>
security:
    authorization: enabled
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>重启、停止和启动 MongoDB</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo service mongod restart
sudo service mongod stop
sudo service mongod start
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>增删改查</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>show databases; #查看已有数据库
use dataName; #选择数据库，如果不存在库，则会自动创建。
show tables; # 查看已有的表
show collections # 同上,
db.createCollection(&#39;表名&#39;);#建表
db.表名.drop(); #删除表

注:table在mongodb里叫collections

增加数据，语法: db.collectionName.isnert(document)

删除数据，语法: db.collection.remove(查询表达式,
选项)。选项是指需要删除的文档数，{0/1}，默认是0，删除全部文档

修改数据，语法: db.collection.update(查询表达式,新值);

查找数据，语法: db.collection.find(查询表达式,查询的列)。
</pre></div>
</div>
</div>
<div class="section" id="nginx">
<h1>Nginx配置<a class="headerlink" href="#nginx" title="永久链接至标题">¶</a></h1>
<p>技术栈:</p>
<p>收费版技术栈</p>
<p>apache web+java+tomcat应用服务器+oracle
+memcached+redhat企业版+svn(代码版本管理工具)</p>
<p>开源技术栈</p>
<p>nginx(负载均衡)+python(virtualenv)+uwsgi(python应用服务器，启动10个django
dfr)+mysql+redis+linu(centos7)+git+vue(前端代码服务器)</p>
<ol class="arabic simple">
<li><p>安装依赖环境</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>yum install gcc patch libffi-devel python-devel  zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel openssl openssl-devel -y
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Nginx安装</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1.下载源码包</span>
wget -c https://nginx.org/download/nginx-1.12.0.tar.gz
<span class="c1"># 2.解压缩源码</span>
tar -zxvf nginx-1.12.0.tar.gz
<span class="c1"># 3.配置，编译安装  开启nginx状态监测功能</span>
./configure --prefix<span class="o">=</span>/opt/nginx1-12/ --with-http_ssl_module --with-http_stub_status_module
make <span class="o">&amp;&amp;</span> make install
<span class="c1"># 4.启动nginx，进入sbin目录,找到nginx启动命令</span>
<span class="nb">cd</span> sbin
./nginx <span class="c1">#启动</span>
./nginx -s stop <span class="c1">#关闭</span>
./nginx -s reload <span class="c1">#重新加载</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>安装完成后检测服务</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>netstat -tunlp <span class="p">|</span>grep <span class="m">80</span>
curl -I <span class="m">127</span>.0.0.1
<span class="c1"># 如果访问不了，检查selinux，iptables防火墙</span>
getenforce
Disabled
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Nginx目录结构</p></li>
</ol>
<ul class="simple">
<li><p>conf 存放nginx所有配置文件的目录,主要nginx.conf</p></li>
<li><p>html 存放nginx默认站点的目录，如index.html、error.html等</p></li>
<li><p>logs 存放nginx默认日志的目录，如error.log access.log</p></li>
<li><p>sbin 存放nginx主命令的目录,sbin/nginx</p></li>
</ul>
<ol class="arabic simple" start="5">
<li><p>Nginx主配置文件解析</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># CoreModule核心模块</span>

user www<span class="p">;</span>                       <span class="c1">#Nginx进程所使用的用户</span>
worker_processes <span class="m">1</span><span class="p">;</span>             <span class="c1">#Nginx运行的work进程数量(建议与CPU数量一致或auto)</span>
error_log /log/nginx/error.log  <span class="c1">#Nginx错误日志存放路径</span>
pid /var/run/nginx.pid          <span class="c1">#Nginx服务运行后产生的pid进程号</span>

<span class="c1"># events事件模块</span>

events <span class="o">{</span>
    worker_connections  <span class="m">1024</span><span class="p">;</span>//每个worker进程支持的最大连接数
    use epool<span class="p">;</span>          //事件驱动模型, epoll默认
<span class="o">}</span>

<span class="c1"># http内核模块</span>

//公共的配置定义在http<span class="o">{}</span>
http <span class="o">{</span>  //http层开始
...
    //使用Server配置网站, 每个Server<span class="o">{}</span>代表一个网站<span class="o">(</span>简称虚拟主机<span class="o">)</span>
    <span class="s1">&#39;server&#39;</span> <span class="o">{</span>
        listen       <span class="m">80</span><span class="p">;</span>        //监听端口, 默认80
        server_name  localhost<span class="p">;</span> //提供服务的域名或主机名
        access_log host.access.log  //访问日志
        //控制网站访问路径
        <span class="s1">&#39;location&#39;</span> / <span class="o">{</span>
            root   /usr/share/nginx/html<span class="p">;</span>   //存放网站代码路径
            index  index.html index.htm<span class="p">;</span>    //服务器返回的默认页面文件
        <span class="o">}</span>
        //指定错误代码, 统一定义错误页面, 错误代码重定向到新的Locaiton
        error_page   <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span>  /50x.html<span class="p">;</span>
    <span class="o">}</span>
    ...
    //第二个虚拟主机配置
    <span class="s1">&#39;server&#39;</span> <span class="o">{</span>
    ...
    <span class="o">}</span>

    include /etc/nginx/conf.d/*.conf<span class="p">;</span>  //包含/etc/nginx/conf.d/目录下所有以.conf结尾的文件

<span class="o">}</span>   //http层结束
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>日志参数</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>log_format    记录日志的格式，可定义多种格式
accsss_log    指定日志文件的路径以及格式


 　　log_format main <span class="s1">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
                      　　<span class="s1">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
                      　　<span class="s1">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>$remote_addr 记录客户端ip</p></li>
<li><p>$remote_user 远程用户，没有就是 “-”</p></li>
<li><p>$time_local 　　 对应[14/Aug/2018:18:46:52 +0800]</p></li>
<li><p>$request　　　 　对应请求信息”GET /favicon.ico HTTP/1.1”</p></li>
<li><p>$status　　　 　状态码</p></li>
<li><p>$body_bytes_sent　　571字节 请求体的大小</p></li>
<li><p>$http_referer　　对应“-”　　由于是直接输入浏览器就是 -</p></li>
<li><p>$http_user_agent　　客户端身份信息</p></li>
<li><p>$http_x_forwarded_for　　记录客户端的来源真实ip 97.64.34.118</p></li>
</ul>
<ol class="arabic simple" start="7">
<li><p>Nginx的允许、拒绝访问</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>server<span class="o">{</span>
...
location / <span class="o">{</span>
    deny <span class="m">192</span>.168.1.0/24<span class="p">;</span>

    allow <span class="m">192</span>.168.0.0/24<span class="p">;</span>
<span class="o">}</span>
...
<span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>error_page 错误页面优化</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>server <span class="o">{</span>
        listen       <span class="m">80</span><span class="p">;</span>
        server_name  www.pythonav.cn<span class="p">;</span>
        root html/python<span class="p">;</span>
        location /<span class="o">{</span>
            index  index.html index.htm<span class="p">;</span>
        <span class="o">}</span>
　   <span class="c1">#在python路径下的40x.html错误页面</span>
        error_page <span class="m">400</span> <span class="m">403</span> <span class="m">404</span> <span class="m">405</span> /40x.html<span class="p">;</span>
        <span class="o">}</span>
</pre></div>
</div>
<div class="section" id="id24">
<h2>Nginx反向代理<a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>实验准备2个nginx服务器</p></li>
</ol>
<p>192.168.13.24 代理服务器</p>
<p>192.168.13.79 web服务器</p>
<ol class="arabic simple" start="2">
<li><p>配置代理服务器192.168.13.24 proxy_pass</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>server <span class="o">{</span>
        listen       <span class="m">80</span><span class="p">;</span>
        server_name  www.pythonav.cn<span class="p">;</span>
        root html/python<span class="p">;</span>
        location /<span class="o">{</span>
            proxy_pass http://192.168.13.79/<span class="p">;</span>
            index  index.html index.htm<span class="p">;</span>
        <span class="o">}</span>
　   <span class="c1">#在python路径下的40x.html错误页面</span>
        error_page <span class="m">400</span> <span class="m">403</span> <span class="m">404</span> <span class="m">405</span> /40x.html<span class="p">;</span>
        <span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id25">
<h2>Nginx负载均衡<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>准备3台计算机</p></li>
</ol>
<p>192.168.13.121 负载均衡器</p>
<p>192.168.13.79 web服务器</p>
<p>192.168.13.24 web服务器</p>
<ol class="arabic simple" start="2">
<li><p>配置代理服务器192.168.13.121</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>upstream webcluster<span class="o">{</span>
server <span class="m">192</span>.168.13.79<span class="p">;</span>
server <span class="m">192</span>.168.13.24<span class="p">;</span>
<span class="o">}</span>


server <span class="o">{</span>
        ...
        location /<span class="o">{</span>
            proxy_pass http://webcluster<span class="p">;</span>
        <span class="o">}</span>
        ...
<span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>upstream分配策略</p></li>
</ol>
<ul class="simple">
<li><p>轮巡</p></li>
<li><p>weight 权重</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>upstream django <span class="o">{</span>
       server <span class="m">10</span>.0.0.10:8000 <span class="nv">weight</span><span class="o">=</span><span class="m">5</span><span class="p">;</span>
       server <span class="m">10</span>.0.0.11:9000 <span class="nv">weight</span><span class="o">=</span><span class="m">10</span><span class="p">;</span><span class="c1">#这个节点访问比率是大于8000的</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>ip_hash 不能和</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>upstream django <span class="o">{</span>
　　　　ip_hash<span class="p">;</span>
       server <span class="m">10</span>.0.0.10:8000<span class="p">;</span>
       server <span class="m">10</span>.0.0.11:9000<span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>backup
在非backup机器繁忙或者宕机时，请求backup机器，因此机器默认压力最小</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>upstream django <span class="o">{</span>
       server <span class="m">10</span>.0.0.10:8000 <span class="nv">weight</span><span class="o">=</span><span class="m">5</span><span class="p">;</span>
       server <span class="m">10</span>.0.0.11:9000<span class="p">;</span>
       server <span class="m">10</span>.0.0.12:8080 backup<span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="uwsgi">
<h1>uWSGI配置<a class="headerlink" href="#uwsgi" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>安装uWSGI</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 进入虚拟环境venv，安装uwsgi</span>
<span class="o">(</span>venv<span class="o">)</span> <span class="o">[</span>root@slave <span class="m">192</span>.168.11.64 /opt<span class="o">]</span><span class="nv">$pip3</span> install uwsgi
<span class="c1"># 检查uwsgi版本</span>
<span class="o">(</span>venv<span class="o">)</span> <span class="o">[</span>root@slave <span class="m">192</span>.168.11.64 /opt<span class="o">]</span><span class="nv">$uwsgi</span> --version
<span class="m">2</span>.0.17.1
<span class="c1"># 检查uwsgi python版本</span>
uwsgi --python-version
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>运行简单测试</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#启动一个python</span>
uwsgi --http :8000 --wsgi-file test.py

http :8000: 使用http协议，端口8000
wsgi-file test.py: 加载指定的文件，test.py

<span class="c1"># test.py</span>
def application<span class="o">(</span>env, start_response<span class="o">)</span>:
    start_response<span class="o">(</span><span class="s1">&#39;200 OK&#39;</span>, <span class="o">[(</span><span class="s1">&#39;Content-Type&#39;</span>,<span class="s1">&#39;text/html&#39;</span><span class="o">)])</span>
    <span class="k">return</span> <span class="o">[</span>b<span class="s2">&quot;Hello World&quot;</span><span class="o">]</span> <span class="c1"># python3</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>启动django项目</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#mysite/wsgi.py  确保找到这个文件</span>
uwsgi --http :8000 --module mysite.wsgi
module mysite.wsgi: 加载指定的wsgi模块
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>uWSGI热加载项目</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>在启动命令后面加上参数
uwsgi --http :8000 --module mysite.wsgi --py-autoreload<span class="o">=</span><span class="m">1</span>
<span class="c1">#发布命令</span>
<span class="nv">command</span><span class="o">=</span> /home/venv/bin/uwsgi --uwsgi <span class="m">0</span>.0.0.0:8000 --chdir /opt/mysite --home<span class="o">=</span>/home/venv --module mysite.wsgi
<span class="c1">#此时修改django代码，uWSGI会自动加载django程序，页面生效</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>配置文件启动uWSGI</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>uwsgi支持ini、xml等多种配置方式，本文以 ini 为例， 在/etc/目录下新建uwsgi_nginx.ini，添加如下配置：

<span class="c1"># mysite_uwsgi.ini file</span>
<span class="o">[</span>uwsgi<span class="o">]</span>

<span class="c1"># Django-related settings</span>
<span class="c1"># the base directory (full path)</span>
<span class="nv">chdir</span>           <span class="o">=</span> /opt/mysite
<span class="c1"># Django&#39;s wsgi file</span>
<span class="nv">module</span>          <span class="o">=</span> mysite.wsgi
<span class="c1"># the virtualenv (full path)</span>
<span class="nv">home</span>            <span class="o">=</span> /opt/venv
<span class="c1"># process-related settings</span>
<span class="c1"># master</span>
<span class="nv">master</span>          <span class="o">=</span> <span class="nb">true</span>
<span class="c1"># maximum number of worker processes</span>
<span class="nv">processes</span>       <span class="o">=</span> <span class="m">1</span>
<span class="c1"># the socket (use the full path to be safe</span>
<span class="c1"># 必须配合Nginx使用socket</span>
<span class="nv">socket</span>          <span class="o">=</span> <span class="m">0</span>.0.0.0:8000
<span class="c1"># 单独使用</span>
<span class="nv">http</span>          <span class="o">=</span> <span class="m">0</span>.0.0.0:8000
<span class="c1"># ... with appropriate permissions - may be needed</span>
<span class="c1"># chmod-socket    = 664</span>
<span class="c1"># clear environment on exit</span>
<span class="nv">vacuum</span>          <span class="o">=</span> <span class="nb">true</span>
<span class="c1"># 后台运行</span>
<span class="nv">daemonize</span> <span class="o">=</span> yes
</pre></div>
</div>
<ol class="arabic" start="6">
<li><p class="rubric" id="id26">指定配置文件启动命令</p>
</li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>uwsgi --ini  /etc/uwsgi_nginx.ini
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>配置nginx</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>worker_processes  <span class="m">1</span><span class="p">;</span>
error_log  logs/error.log<span class="p">;</span>
pid        logs/nginx.pid<span class="p">;</span>
events <span class="o">{</span>
    worker_connections  <span class="m">1024</span><span class="p">;</span>
<span class="o">}</span>
http <span class="o">{</span>
    include       mime.types<span class="p">;</span>
    default_type  application/octet-stream<span class="p">;</span>
    log_format  main  <span class="s1">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
                      <span class="s1">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
                      <span class="s1">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>
    access_log  logs/access.log  main<span class="p">;</span>
    sendfile        on<span class="p">;</span>
    keepalive_timeout  <span class="m">65</span><span class="p">;</span>
　　<span class="c1">#nginx反向代理uwsgi</span>
    server <span class="o">{</span>
        listen       <span class="m">80</span><span class="p">;</span>
        server_name  <span class="m">192</span>.168.11.64<span class="p">;</span>
        location / <span class="o">{</span>
　　　　  <span class="c1">#nginx自带ngx_http_uwsgi_module模块，起到nginx和uwsgi交互作用</span>
         <span class="c1">#通过uwsgi_pass设置服务器地址和协议，讲动态请求转发给uwsgi处理</span>
         include  /opt/nginx1-12/conf/uwsgi_params<span class="p">;</span>
         uwsgi_pass <span class="m">0</span>.0.0.0:8000<span class="p">;</span>
            root   html<span class="p">;</span>
            index  index.html index.htm<span class="p">;</span>
        <span class="o">}</span>
　　　　  <span class="c1">#nginx处理静态页面资源</span>
　　　　  location /static<span class="o">{</span>
　　　　　　　　<span class="nb">alias</span> /opt/nginx1-12/static<span class="p">;</span>
         <span class="o">}</span>
　　　　　<span class="c1">#nginx处理媒体资源</span>
　　　　　location /media<span class="o">{</span>
　　　　　　　　<span class="nb">alias</span> /opt/nginx1-12/media<span class="p">;</span>
         <span class="o">}</span>
        error_page   <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span>  /50x.html<span class="p">;</span>
        <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
            root   html<span class="p">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="supervisor">
<h1>supervisor 进程管理工具<a class="headerlink" href="#supervisor" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>将linux进程运行在后台的方法有哪些</p></li>
</ol>
<ul class="simple">
<li><p>命令后面加上 &amp; 符号</p></li>
<li><p>使用nohup命令</p></li>
<li><p>使用进程管理工具supervisor</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>安装supervisor,使用Python2的包管理工具easy_install</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># apt install python-setuptools  #如果没有easy_install命令</span>
easy_install supervisor
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>通过命令生成supervisor的配支文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>echo_supervisord_conf &gt; /etc/supervisord.conf
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>再/etc/supervisord.conf末尾添加上如下代码！！！！！！</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>program:my<span class="o">]</span>
<span class="c1">#command=/opt/venv/bin/uwsgi --ini  /etc/uwsgi_nginx.ini  #这里是结合virtualenv的命令 和supervisor的精髓！！！！</span>
<span class="nv">command</span><span class="o">=</span> /home/venv/bin/uwsgi --uwsgi <span class="m">0</span>.0.0.0:8000 --chdir /opt/mysite --home<span class="o">=</span>/home/venv --module mysite.wsgi
<span class="c1">#--home指的是虚拟环境目录  --module找到 mysite/wsgi.py</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># supervisord.conf配置文件参数解释</span>
<span class="c1"># [program:xx]是被管理的进程配置参数，xx是进程的名称</span>
<span class="o">[</span>program:xx<span class="o">]</span>
<span class="nv">command</span><span class="o">=</span>/opt/apache-tomcat-8.0.35/bin/catalina.sh run  <span class="p">;</span> 程序启动命令
<span class="nv">autostart</span><span class="o">=</span><span class="nb">true</span>       <span class="p">;</span> 在supervisord启动的时候也自动启动
<span class="nv">startsecs</span><span class="o">=</span><span class="m">10</span>         <span class="p">;</span> 启动10秒后没有异常退出，就表示进程正常启动了，默认为1秒
<span class="nv">autorestart</span><span class="o">=</span><span class="nb">true</span>     <span class="p">;</span> 程序退出后自动重启,可选值：<span class="o">[</span>unexpected,true,false<span class="o">]</span>，默认为unexpected，表示进程意外杀死后才重启
<span class="nv">startretries</span><span class="o">=</span><span class="m">3</span>       <span class="p">;</span> 启动失败自动重试次数，默认是3
<span class="nv">user</span><span class="o">=</span>tomcat          <span class="p">;</span> 用哪个用户启动进程，默认是root
<span class="nv">priority</span><span class="o">=</span><span class="m">999</span>         <span class="p">;</span> 进程启动优先级，默认999，值小的优先启动
<span class="nv">redirect_stderr</span><span class="o">=</span><span class="nb">true</span> <span class="p">;</span> 把stderr重定向到stdout，默认false
<span class="nv">stdout_logfile_maxbytes</span><span class="o">=</span>20MB  <span class="p">;</span> stdout 日志文件大小，默认50MB
<span class="nv">stdout_logfile_backups</span> <span class="o">=</span> <span class="m">20</span>   <span class="p">;</span> stdout 日志文件备份数，默认是10
<span class="p">;</span> stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）
<span class="nv">stdout_logfile</span><span class="o">=</span>/opt/apache-tomcat-8.0.35/logs/catalina.out
<span class="nv">stopasgroup</span><span class="o">=</span><span class="nb">false</span>     <span class="p">;</span>默认为false,进程被杀死时，是否向这个进程组发送stop信号，包括子进程
<span class="nv">killasgroup</span><span class="o">=</span><span class="nb">false</span>     <span class="p">;</span>默认为false，向进程组发送kill信号，包括子进程
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>启动supervisord服务端，指定配置文件启动</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>supervisord -c /etc/supervisord.conf
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>重新加载supervisor</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>一、添加好配置文件后

二、更新新的配置到supervisord

supervisorctl update
三、重新启动配置中的所有程序

supervisorctl reload
四、启动某个进程<span class="o">(</span><span class="nv">program_name</span><span class="o">=</span>你配置中写的程序名称<span class="o">)</span>

supervisorctl start program_name
五、查看正在守候的进程

supervisorctl
六、停止某一进程 <span class="o">(</span><span class="nv">program_name</span><span class="o">=</span>你配置中写的程序名称<span class="o">)</span>

pervisorctl stop program_name
七、重启某一进程 <span class="o">(</span><span class="nv">program_name</span><span class="o">=</span>你配置中写的程序名称<span class="o">)</span>

supervisorctl restart program_name
八、停止全部进程

supervisorctl stop all
注意：显示用stop停止掉的进程，用reload或者update都不会自动重启。
</pre></div>
</div>
</div>
<div class="section" id="nodejsnpm">
<h1>安装nodejs、npm<a class="headerlink" href="#nodejsnpm" title="永久链接至标题">¶</a></h1>
<ol class="arabic">
<li><p>安装</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get install nodejs
sudo apt-get install npm
</pre></div>
</div>
</li>
<li><p>升级npm、nodejs</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo npm install npm -g
sudo npm install –g n
sudo n latest   <span class="c1">#(升级node.js到最新版)</span>
<span class="c1"># or $ n stable（升级node.js到最新稳定版）</span>
</pre></div>
</div>
</li>
<li><p>切换淘宝镜像</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo npm install -g cnpm --registry<span class="o">=</span>https://registry.npm.taobao.org
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>安装yarn</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get upgrade
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg <span class="p">|</span> sudo apt-key add -
<span class="nb">echo</span> <span class="s2">&quot;deb https://dl.yarnpkg.com/debian/ stable main&quot;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt-get update
sudo apt-get install yarn
<span class="c1"># 如果用的是nvm，要这样安装：</span>
<span class="c1"># sudo apt install --no-install-recommends yarn</span>
yarn --version

<span class="c1">#yarn换淘宝源</span>
yarn config <span class="nb">set</span> registry https://registry.npm.taobao.org
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>安装vue</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>yarn global add @vue/cli

sudo find / -name <span class="s2">&quot;vue&quot;</span>
<span class="c1"># /home/li/.yarn/bin/vue</span>

<span class="nb">echo</span> <span class="s1">&#39;# set PATH for yarn</span>
<span class="s1">if [ -d &quot;$HOME/.yarn/bin&quot; ] ; then</span>
<span class="s1">    PATH=&quot;$HOME/.yarn/bin:$PATH&quot;</span>
<span class="s1">fi&#39;</span> &gt;&gt; ~/.profile
. ~/.profile
vue --version
</pre></div>
</div>
</div>
<div class="section" id="git-clone">
<h1>git clone 提速<a class="headerlink" href="#git-clone" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>nslookup github.global.ssl.fastly.Net
nslookup github.com

sudo vim /etc/hosts
<span class="c1"># 添加对应的域名地址</span>
github.com <span class="m">13</span>.250.177.223
github.global.ssl.fastly.Net <span class="m">31</span>.13.69.86

<span class="c1"># 重启DNS</span>
sudo /etc/init.d/networking restart
</pre></div>
</div>
</div>
<div class="section" id="systemback-ios">
<h1>安装 systemback 备份IOS镜像<a class="headerlink" href="#systemback-ios" title="永久链接至标题">¶</a></h1>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ubuntu 16.04的Systemback二进制文件与Ubuntu 18.04/18.10兼容，因此我们可以使用以下命令在18.04/18.10上添加Ubuntu 16.04 PPA</span>
sudo add-apt-repository <span class="s2">&quot;deb http://ppa.launchpad.net/nemh/systemback/ubuntu xenial main&quot;</span>

<span class="c1">#导入此PPA的GPG签名密钥</span>
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 382003C2C8B7B4AB813E915B14E4942973C62A1B

<span class="c1"># 更新</span>
sudo apt update

<span class="c1"># 安装systemback</span>
sudo apt install systemback
</pre></div>
</div>
<div class="section" id="systemback4gubuntu">
<h2>Systemback制作大于4G的Ubuntu系统镜像<a class="headerlink" href="#systemback4gubuntu" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 解压 .sblive 文件</span>
mkdir sblive
tar -xf /home/systemback_live_2018-10-15.sblive -C sblive

<span class="c1"># 重命名syslinux 至 isolinux</span>
mv sblive/syslinux/syslinux.cfg sblive/syslinux/isolinux.cfg
mv sblive/syslinux sblive/isolinux

<span class="c1"># 安装cdtools</span>
sudo apt install aria2
aria2c -s <span class="m">10</span> https://nchc.dl.sourceforge.net/project/cdrtools/alpha/cdrtools-3.02a07.tar.gz
tar -xvf cdrtools-3.02a07.tar.gz
<span class="nb">cd</span> cdrtools-3.02
make
sudo make install

<span class="c1"># 生成ISO文件</span>
/opt/schily/bin/mkisofs -iso-level <span class="m">3</span> -r -V sblive -cache-inodes -J -l -b isolinux/isolinux.bin -no-emul-boot -boot-load-size <span class="m">4</span> -boot-info-table -c isolinux/boot.cat -o sblive.iso sblive
</pre></div>
</div>
</div>
</div>
<div class="section" id="fastdfs">
<h1>FastDFS文件管理系统<a class="headerlink" href="#fastdfs" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>下载FastDFS软件包、依赖库libfastcommon、Nginx、fastdfs-nginx-module</p></li>
</ol>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/happyfish100/FastDFS">https://github.com/happyfish100/FastDFS</a></p></li>
<li><p><a class="reference external" href="https://github.com/happyfish100/libfastcommon/releases">https://github.com/happyfish100/libfastcommon/releases</a></p></li>
<li><p><a class="reference external" href="https://nginx.org/download/">https://nginx.org/download/</a></p></li>
<li><p><a class="reference external" href="https://github.com/happyfish100/fastdfs-nginx-module/releases">https://github.com/happyfish100/fastdfs-nginx-module/releases</a></p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>安装libfastcommon依赖包</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>unzip libfastcommon-master.zip
<span class="nb">cd</span> libfastcommon-master
./make.sh
./make.sh install
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>安装FastDFS</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>unzip fastdfs-master.zip
<span class="nb">cd</span> fastdfs-master
./make.sh
./make.sh install
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>配置跟踪服务器tracker</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf
mkdir -p /home/li/fastdfs/tracker

vim /etc/fdfs/tracker.conf
<span class="c1"># 修改base_path</span>
<span class="nv">base_path</span><span class="o">=</span>/home/li/fastdfs/tracker
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>配置存储服务器storage</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf
mkdir –p /home/li/fastdfs/storage

vim /etc/fdfs/storage.conf
<span class="c1"># 修改base_path、store_path0、tracker_server</span>
<span class="nv">base_path</span><span class="o">=</span>/home/li/fastdfs/storage
<span class="nv">store_path0</span><span class="o">=</span>/home/li/fastdfs/storage
<span class="nv">tracker_server</span><span class="o">=</span>自己ubuntu虚拟机的ip地址:22122
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>启动tracker 和 storage</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo service fdfs_trackerd start
sudo service fdfs_storaged start
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>配置client</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf

vim /etc/fdfs/client.conf
<span class="c1"># 修改base_path、tracker_server</span>
<span class="nv">base_path</span><span class="o">=</span>/home/li/fastdfs/tracker
<span class="nv">tracker_server</span><span class="o">=</span>自己ubuntu虚拟机的ip地址:22122
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>测试是否可以上传</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>fdfs_upload_file /etc/fdfs/client.conf ./下载/photo.jpg
<span class="c1"># 输出如下格式</span>
group1/M00/00/00/wKgygF6KuQCAVACRAAQkAzlJUnE969.jpg
</pre></div>
</div>
<div class="section" id="nginxfastdfs-nginx-module">
<h2>安装nginx及fastdfs-nginx-module<a class="headerlink" href="#nginxfastdfs-nginx-module" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>安装依赖库</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt-get install libpcre3 libpcre3-dev libpcrecpp0v5 libssl-dev zlib1g-dev -y

<span class="c1"># 安装gcc g++的依赖库</span>
apt-get install build-essential libtool
<span class="c1"># 安装 pcre依赖库</span>
apt-get install libpcre3 libpcre3-dev
<span class="c1"># 安装 zlib依赖库</span>
apt-get install zlib1g-dev
<span class="c1"># 安装 ssl依赖库</span>
apt-get install openssl
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>解压源码包</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tar -xvf nginx-1.12.2.tar
unzip fastdfs-nginx-module-master.zip
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>安装nginx</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> nginx-1.12.2
./configure --prefix<span class="o">=</span>/usr/local/nginx/ --add-module<span class="o">=</span>/home/li/下载/fastdfs-module-master/src

make <span class="o">&amp;&amp;</span> make install
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>修改配置文件</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp fastdfs-nginx-module-master/src/mod_fastdfs.conf /etc/fdfs/

vim /etc/fdfs/mod_fastdfs.conf

<span class="nv">connect_timeout</span><span class="o">=</span><span class="m">10</span>
<span class="nv">tracker_server</span><span class="o">=</span>自己ubuntu虚拟机的ip地址:22122
<span class="nv">url_have_group_name</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">store_path0</span><span class="o">=</span>/home/li/fastdfs/storage
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>将fastdfs-master/conf下的http.conf、mime.types复制到/etc/fdfs/</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp http.conf /etc/fdfs/
cp mime.types /etc/fdfs/
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>修改nginx配置文件添加如下</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vim /usr/local/nginx/conf/nginx.conf

server <span class="o">{</span>
            listen       <span class="m">8888</span><span class="p">;</span>
            server_name  localhost<span class="p">;</span>
            location ~/group<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>/ <span class="o">{</span>
                ngx_fastdfs_module<span class="p">;</span>
            <span class="o">}</span>
            error_page   <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span>  /50x.html<span class="p">;</span>
            <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
            root   html<span class="p">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>启动nginx</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo /usr/local/nginx/sbin/nginx
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>python客户端上传测试</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install fdfs_client-py-master.zip
</pre></div>
</div>
</div>
</div>
<div class="section" id="ubuntukms">
<h1>Ubuntu搭建KMS服务器<a class="headerlink" href="#ubuntukms" title="永久链接至标题">¶</a></h1>
<ol class="arabic simple">
<li><p>在任意环境中，下载最新的vlmcsd
releases版本，<a class="reference external" href="https://github.com/Wind4/vlmcsd/releases">下载地址</a>。如在linux中，可以使用wget下载</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wget https://github.com/Wind4/vlmcsd/releases/download/svn1111/binaries.tar.gz
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>解压安装包</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tar -zxvf binaries.tar.gz
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>运行脚本</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> binaries/Linux/intel/static/
./vlmcsd-x64-musl-static

<span class="c1"># 查看1688端口</span>
netstat -lnp<span class="p">|</span>grep <span class="m">1688</span>
ps aux <span class="p">|</span> grep vlmcsd
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>激活windows系统</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>slmgr /skms 你的Ubuntu的IP地址（Ubuntu中使用ifconfig查看IP地址）
slmgr /ato

<span class="c1"># 验证激活</span>
slmgr.vbs -dlv
</pre></div>
</div>
</div>
<div class="section" id="ubuntu-docker">
<h1>Ubuntu 安装Docker<a class="headerlink" href="#ubuntu-docker" title="永久链接至标题">¶</a></h1>
<ol class="arabic">
<li><p>安装Docker</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wget -qO- https://get.docker.com/ <span class="p">|</span> sh
<span class="c1"># 国内镜像</span>
curl -fsSL https://get.docker.com <span class="p">|</span> bash -s docker --mirror Aliyun
docker --version
</pre></div>
</div>
</li>
<li><p><a class="reference external" href="https://www.daocloud.io/mirror#accelerator-doc">Docker 加速器</a></p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl -sSL https://get.daocloud.io/daotools/set_mirror.sh <span class="p">|</span> sh -s https://b33dfgq9.mirror.aliyuncs.com
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>安装 <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code></p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo apt install docker-compose
docker-compose --version
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p><a class="reference external" href="https://www.cnblogs.com/reasonzzy/p/11377324.html">Docker图形化工具</a></p></li>
<li><p><a class="reference external" href="https://www.jianshu.com/p/ca1623ac7723">相关命令</a></p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 进入容器</span>
docker <span class="nb">exec</span> -it redis-test /bin/bash
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>docker常用命令</p></li>
<li><p>镜像相关</p></li>
</ol>
<ul class="simple">
<li><p>docker search java：在Docker
Hub（或阿里镜像）仓库中搜索关键字（如java）的镜像</p></li>
<li><p>docker pull java:8：从仓库中下载镜像，若要指定版本，则要在冒号后指定</p></li>
<li><p>docker images：列出已经下载的镜像</p></li>
<li><p>docker rmi java：删除本地镜像</p></li>
<li><p>docker build：构建镜像</p></li>
</ul>
<p>```shell # 基于的基础镜像 FROM python:3.6.9</p>
<p># 维护者信息</p>
<p>MAINTAINER LHM  <a class="reference external" href="mailto:lhm&#37;&#52;&#48;ikahe&#46;com">lhm<span>&#64;</span>ikahe<span>&#46;</span>com</a></p>
<p># 代码添加到code文件夹</p>
<p>ADD ./docker_test /code</p>
<p># 设置code文件夹是工作目录</p>
<p>WORKDIR /code</p>
<p># 安装支持</p>
<p>RUN pip install -r requirements.txt</p>
<p>CMD [“python”, “/code/server.py”] ```</p>
<ol class="arabic simple" start="2">
<li><p>容器相关</p></li>
</ol>
<ul class="simple">
<li><p>docker run -d -p 91:80 nginx
：在后台运行nginx，若没有镜像则先下载，并将容器的80端口映射为宿主机的91端口。</p></li>
<li><p>-d：后台运行</p></li>
<li><p>-P：随机端口映射</p></li>
<li><p>-p：指定端口映射</p></li>
<li><p>-net：网络模式</p></li>
<li><p>docker ps：列出运行中的容器</p></li>
<li><p>docker ps -a ：列出所有的容器</p></li>
<li><p>docker stop 容器id：停止容器</p></li>
<li><p>docker kill 容器id：强制停止容器</p></li>
<li><p>docker start 容器id：启动已停止的容器</p></li>
<li><p>docker inspect 容器id：查看容器的所有信息</p></li>
<li><p>docker container logs 容器id：查看容器日志</p></li>
<li><p>docker top 容器id：查看容器里的进程</p></li>
<li><p>docker exec -it 容器id /bin/bash：进入容器</p></li>
<li><p>exit：退出容器</p></li>
<li><p>docker rm 容器id：删除已停止的容器</p></li>
<li><p>docker rm -f 容器id：删除正在运行的容器</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">shell</span>&#160;&#160; <span class="pre">#</span> <span class="pre">导出镜像</span>&#160;&#160; <span class="pre">docker</span> <span class="pre">save</span> <span class="pre">-o</span> <span class="pre">/home/user/images/ubuntu_14.04.tar</span> <span class="pre">ubuntu:14.04</span>&#160;&#160; <span class="pre">#</span> <span class="pre">导入镜像</span>&#160;&#160; <span class="pre">docker</span> <span class="pre">load</span> <span class="pre">--input</span> <span class="pre">ubuntu_14.04.tar</span></code></p>
<div class="section" id="id27">
<h2>搭建Nginx<a class="headerlink" href="#id27" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker pull nginx

mkdir -p /data/nginx/<span class="o">{</span>conf,conf.d,html,logs<span class="o">}</span>

docker run --name mynginx -d -p <span class="m">80</span>:80  <span class="se">\</span>
-v /data/nginx/conf/nginx.conf:/etc/nginx/nginx.conf  <span class="se">\</span>
-v /data/nginx/logs:/var/log/nginx <span class="se">\</span>
-d nginx
</pre></div>
</div>
<p><a class="reference external" href="https://trac.nginx.org/nginx/export/HEAD/nginx/conf/nginx.conf">nginx.conf</a>官方下载</p>
</div>
<div class="section" id="id28">
<h2>搭建Mysql<a class="headerlink" href="#id28" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker pull mysql
docker run -p <span class="m">3306</span>:3306 --name mysql -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root -d mysql

<span class="c1"># 建立目录映射</span>
docker run -p <span class="m">3306</span>:3306 --name mysql <span class="se">\</span>
-v /usr/local/docker/mysql/conf:/etc/mysql <span class="se">\</span>
-v /usr/local/docker/mysql/logs:/var/log/mysql <span class="se">\</span>
-v /usr/local/docker/mysql/data:/var/lib/mysql <span class="se">\</span>
-e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root <span class="se">\</span>
-d mysql
</pre></div>
</div>
</div>
<div class="section" id="id29">
<h2>搭建Redis<a class="headerlink" href="#id29" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># pull镜像</span>
docker pull redis

<span class="c1"># 在/usr/local目录下创建docker目录</span>
mkdir /usr/local/docker
<span class="nb">cd</span> /usr/local/docker
<span class="c1"># 再在docker目录下创建redis目录</span>
mkdir redis<span class="o">&amp;&amp;</span><span class="nb">cd</span> redis
<span class="c1"># 创建配置文件，并将官网redis.conf文件配置复制下来进行修改</span>
touch redis.conf
<span class="c1"># 创建数据存储目录data</span>
mkidr data
</pre></div>
</div>
<p><a class="reference external" href="http://download.redis.io/redis-stable/redis.conf">redis.conf</a>官网下载地址</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>修改启动默认配置<span class="o">(</span>从上至下依次<span class="o">)</span>：

<span class="nb">bind</span> <span class="m">127</span>.0.0.1 <span class="c1">#注释掉这部分，这是限制redis只能本地访问</span>
protected-mode no <span class="c1">#默认yes，开启保护模式，限制为本地访问</span>
daemonize no#默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程，改为yes会使配置文件方式启动redis失败
databases <span class="m">16</span> <span class="c1">#数据库个数（可选），我修改了这个只是查看是否生效。。</span>
dir  ./ <span class="c1">#输入本地redis数据库存放文件夹（可选）</span>
appendonly yes <span class="c1">#redis持久化（可选）</span>
requirepass  密码 <span class="c1">#配置redis访问密码</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 创建并启动redis容器</span>
docker run -p <span class="m">6379</span>:6379 --name redis <span class="se">\</span>
-v /usr/local/docker/redis/redis.conf:/etc/redis/redis.conf <span class="se">\</span>
-v /usr/local/docker/redis/data:/data <span class="se">\</span>
-d redis redis-server /etc/redis/redis.conf --appendonly yes
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h2>搭建MongoDB<a class="headerlink" href="#id30" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker pull mongo

<span class="c1"># --auth 需要密码才能访问容器服务</span>
docker run -itd --name mongo -p <span class="m">27017</span>:27017 mongo --auth

docker <span class="nb">exec</span> -it mongo mongo admin
&gt;  db.createUser<span class="o">({</span> user:<span class="s1">&#39;admin&#39;</span>,pwd:<span class="s1">&#39;123456&#39;</span>,roles:<span class="o">[</span> <span class="o">{</span> role:<span class="s1">&#39;userAdminAnyDatabase&#39;</span>, db: <span class="s1">&#39;admin&#39;</span><span class="o">}]})</span><span class="p">;</span>
&gt; db.auth<span class="o">(</span><span class="s1">&#39;admin&#39;</span>, <span class="s1">&#39;123456&#39;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="sentry">
<h2>搭建Sentry<a class="headerlink" href="#sentry" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 下载Sentry</span>
git clone https://github.com/getsentry/onpremise.git
<span class="c1"># 创建目录</span>
mkdir -p data/<span class="o">{</span>sentry,postgres<span class="o">}</span>
<span class="c1"># 获取项目的 key</span>
docker-compose run --rm web config generate-secret-key
<span class="c1"># 复制获取到的 key 字符串</span>
vim docker-compose.yml
SENTRY_SECRET_KEY
<span class="c1"># 创建项目的 superuser</span>
docker-compose run --rm web upgrade
<span class="c1"># 开启 sentry 服务</span>
docker-compose up -d
</pre></div>
</div>
</div>
<div class="section" id="elasticsearch">
<h2>搭建elasticsearch<a class="headerlink" href="#elasticsearch" title="永久链接至标题">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker pull elasticsearch:版本号
<span class="c1"># 不选择版本就是最新的</span>

docker run --name<span class="o">=</span>test_es -d -p <span class="m">9200</span>:9200 -p <span class="m">9300</span>:9300 docker.io/elasticsearch

<span class="c1"># 查看容器运行状态</span>
docker ps
docker ps -a <span class="c1"># 查看所有的容器</span>
<span class="c1"># 未启动查看 logs</span>
docker logs test_es

<span class="c1">## 发现虚拟机内存太小了</span>
<span class="c1"># OpenJDK 64-Bit Server VM warning: INFO: os::commit_memory(0x0000000094cc0000, 1798569984, 0) failed;</span>
<span class="c1"># error=&#39;Cannot allocate memory&#39; (errno=12)</span>
<span class="c1">#</span>
<span class="c1"># There is insufficient memory for the Java Runtime Environment to continue.</span>
<span class="c1"># Native memory allocation (mmap) failed to map 1798569984 bytes for committing reserved memory.</span>
<span class="c1"># An error report file with more information is saved as:</span>
<span class="c1"># /tmp/hs_err_pid1.log</span>

<span class="c1"># 启动test_es 容器</span>
docker start test_es

<span class="c1"># 删除容器</span>
docker rm test_es
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="django_restframework.html" class="btn btn-neutral float-right" title="django restframework" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to Li’s BLOG’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, LHM

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>