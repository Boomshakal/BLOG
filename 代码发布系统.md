# 代码发布系统

## ansible

批量在远程主机上面执行命令

1. 安装

```shell
sudo apt-get install ansible
# 生成ssh免密登陆
ssh-keygen -t rsa
ssh-copy-id  root@ip(ip是被ansible管理的节点地址)
```

2. ansible 命令格式

```shell
ansible <host-pattern> [options]
-a MODULE_ARGS, --args=MODULE_ARGS  # 模块参数
-C, --check           # 检查
-f FORKS, --forks=FORKS # 用来做高并发的
--list-hosts #列出主机列表
-m MODULE_NAME #模块名称
--syntax-check #语法检查
```

3. host文件

```shell
# It should live in /etc/ansible/hosts
#
#   - Comments begin with the '#' character
#   - Blank lines are ignored
#   - Groups of hosts are delimited by [header] elements
#   - You can enter hostnames or ip addresses
#   - A hostname/ip can be a member of multiple groups
```

4. host-pattern格式

- 单个主机
- 全部主机
- 多个主机
- 单个组
- 多个组
  - 交集'web:&db'
  - 并集'web:db' or web,db
  - 差集'web:!db'

5. ansible-doc命令

```shell
ansible-doc [-l|-F|-s] [options] [-t <plugin type> ] [plugin]
-l, --list  # 列出所有
-s, --snippet # 切片方式列出

ansible-doc -s ping
```

6. command 模块

```shell
ansible web -a 'ls /'
ansible web -a 'pwd'
ansible web -a 'chdir=/tmp pwd' #切换目录执行命令，使用场景是编译安装时使用
ansible web -a 'create=/tmp pwd' #用来判断/tmp目录是否存在，存在就不执行操作
ansible web -a 'create=/data pwd' # 因为data不存在，所以就会执行pwd命令
ansible web -a 'removes=/tmp pwd' #用来判断/tmp目录是否存在，存在就执行操作
ansible web -a 'removes=/data pwd' #因为data不存在，所以就会不执行pwd命令
```

7. 添加用户查看用户是否创建成功

```shell
useradd li
tail -1 /etc/passwd
tail -1 /etc/shadow
id li
echo '123' | passwd --stdin li # 设置密码
```

8. shell模块

```shell
ansible web -m shell -a 'echo '123' | passwd --stdin li'
ansible 192.168.1.5 -m shell -a 'bash a.sh' 
ansible 192.168.1.5 -m shell -a '/root/a.sh'  # 注意a.sh 为可执行权限
ansible 192.168.1.5 -m shell -a '/root/a.py' # 可执行python脚本
```













## openpyxl

操作execl表格





